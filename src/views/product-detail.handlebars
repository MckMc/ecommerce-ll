<a href="/products">← Volver</a>

<div class="detail">
  <div class="detail-media">
    <img src="{{product.image}}" alt="{{product.title}}"
     onerror="this.onerror=null;this.src='/img/products/fallback.jpg'">
  </div>
  <div class="detail-info">
    <h1>{{product.title}}</h1>
    <p class="detail-price">${{product.price}}</p>
    <p class="detail-stock">Stock: {{product.stock}}</p>
    <button id="addBtn" class="btn-primary">Agregar al carrito</button>
  </div>
</div>

<script>
(async () => {
  let cartId = localStorage.getItem('cartId');
  if (!cartId) {
    const r = await fetch('/api/carts', { method: 'POST' });
    const d = await r.json();
    cartId = d._id || d.id; localStorage.setItem('cartId', cartId);
  }
  document.getElementById('addBtn').onclick = async () => {
    const pid = "{{product._id}}";
    const res = await fetch(`/api/carts/${cartId}/product/${pid}`, { method:'POST' });
    if (!res.ok) return alert('No se pudo agregar al carrito');
    alert('Agregado al carrito ✔');
  };
})();
</script>

<link rel="stylesheet" href="/css/products.css">
<style>
.detail{display:grid;grid-template-columns:1.2fr 1fr;gap:24px}
.detail-media{width:100%;aspect-ratio:4/3;overflow:hidden;border-radius:16px;background:#0a0a0a}
.detail-media img{width:100%;height:100%;object-fit:cover;display:block}
.detail-price{font-size:1.25rem;font-weight:800;margin:4px 0 12px}
.btn-primary{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
@media (max-width:820px){.detail{grid-template-columns:1fr}}
</style>

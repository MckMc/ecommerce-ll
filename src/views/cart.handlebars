<h1>Carrito</h1>

{{#if cart.products.length}}
    <ul id="items">
        {{#each cart.products}}
        <li>
            {{this.product.title}} — ${{this.product.price}} × {{this.quantity}}
            
            <button onclick="removeFromCart('{{../cart._id}}','{{this.product._id}}')">Eliminar</button>
        </li>
        {{/each}}
    </ul>

    <p id="total"></p>
    <button id="emptyBtn">Vaciar carrito</button>

<script id="cart-data" type="application/json">
  {{{json cart.products}}}
</script>

<script>
  const items = JSON.parse(document.getElementById('cart-data').textContent);
  const total = items.reduce((a,i)=> a + (i.product?.price||0)*i.quantity, 0);
  const fmt = new Intl.NumberFormat('es-AR',{ style:'currency', currency:'USD' });
  document.getElementById('total').textContent = 'Total: ' + fmt.format(total);
</script>


<script>
        // eliminar un ítem
        async function removeFromCart(cid, pid){
            const res = await fetch(`/api/carts/${cid}/products/${pid}`, { method:'DELETE' });
            if (!res.ok) return alert('No se pudo eliminar');
            location.reload();
        }

    // vaciar carrito
        document.getElementById('emptyBtn').addEventListener('click', async ()=>{
            const cid = '{{cart._id}}';
            const res = await fetch(`/api/carts/${cid}`, { method:'DELETE' });
            if (!res.ok) return alert('No se pudo vaciar');
            location.reload();
        });
    </script>
{{else}}
    <p>Carrito vacío.</p>
{{/if}}
